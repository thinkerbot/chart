drop table if exists topics;
create table topics (
  id     varchar,
  type   varchar,
  config varchar,
  primary key (id)
);
<% require 'chart/topics' %>
<% require 'chart/storage_types' %>
<% Chart::Topic::TYPES.each_pair do |type, topic_class| %>
<%   table_name   = Chart::StorageTypes::CassandraStorage.table_name_for(type) %>
<%   columns      = Chart::StorageTypes::CassandraStorage.columns_for_type(type) %>
<%   order_columns = columns.dup; order_columns.delete_at(1) %>

drop table if exists <%= table_name %>;
create table <%= table_name %> (
  xp varint,
  id varchar,<% columns.each do |name, typestr| %>
  <%= name %>  <%= typestr %>,<% end %>
  primary key ((xp, id), <%= (order_columns + columns[1,1]).map(&:first).join(', ') %>)
)
with clustering order by (
<%= order_columns.map {|name, typestr| "  #{name} desc" }.join(",\n") %>

);
<% end %>
